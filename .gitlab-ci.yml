image: golang:latest

stages:
  - test

test_job:
  stage: test
  script:
  - echo $GOPATH
  - export PATH=$PATH:$GOPATH/bin
  - export PROJECT_DIR=$GOPATH/src/syifan/yaotsu
  - mkdir -p $PROJECT_DIR
  - cp -r ${CI_PROJECT_DIR}/ $PROJECT_DIR
  - cd $PROJECT_DIR && go get ./...
  - go get github.com/tools/godep
  - cd $PROJECT_DIR && godep save ./...
  - go install github.com/onsi/ginkgo/ginkgo
  - cd $PROJECT_DIR && go build ./...
  - cd $PROJECT_DIR && ginkgo -r --randomizeAllSpecs --randomizeSuites --failOnPending --cover --trace --race --progress